---
slug: /en/observability/apm-running-on-docker
title: Run APM Server on Docker
description: Description to be written
tags: []
---

<div id="apm-running-on-docker"></div>

Docker images for APM Server are available from the Elastic Docker
registry. The base image is [ubuntu:22.04](https://hub.docker.com/_/ubuntu).

A list of all published Docker images and tags is available at
[www.docker.elastic.co](https://www.docker.elastic.co).

These images are free to use under the Elastic license. They contain open source
and free commercial features and access to paid commercial features.
[Start a 30-day trial](((kibana-ref))/managing-licenses.html) to try out all of the
paid commercial features. See the
[Subscriptions](https://www.elastic.co/subscriptions) page for information about
Elastic license levels.

<div id="pull_the_image"></div>

## Pull the image

Obtaining APM Server for Docker is as simple as issuing a `docker pull` command
against the Elastic Docker registry and then, optionally, verifying the image.

<DocIf condition={ "((release-state))" === "unreleased" }>

However, version ((version)) of APM Server has not yet been
released, so no Docker image is currently available for this version.

</DocIf>

<DocIf condition={ "((release-state))" !== "unreleased" }>

1. Pull the Docker image:

    ```sh
    docker pull docker.elastic.co/apm/apm-server:((version))
    ```

1. Verify the Docker image:

    ```sh
    wget https://artifacts.elastic.co/cosign.pub
    cosign verify --key cosign.pub docker.elastic.co/apm/apm-server:((version))
    ```

    The `cosign` command prints the check results and the signature payload in JSON format:

    ```sh
    Verification for docker.elastic.co/apm/apm-server:((version)) --
    The following checks were performed on each of these signatures:
      - The cosign claims were validated
      - Existence of the claims in the transparency log was verified offline
      - The signatures were verified against the specified public key
    ```

</DocIf>

<div id="configure_apm_server_on_docker"></div>

## Configure APM Server on Docker

The Docker image provides several methods for configuring APM Server. The
conventional approach is to provide a configuration file via a volume mount, but
it's also possible to create a custom image with your
configuration included.

<div id="example_configuration_file"></div>

### Example configuration file

Download this example configuration file as a starting point:

```sh
curl -L -O https://raw.githubusercontent.com/elastic/apm-server/((branch))/apm-server.docker.yml
```

<div id="volume-mounted_configuration"></div>

### Volume-mounted configuration

One way to configure APM Server on Docker is to provide `apm-server.docker.yml` via a volume mount.
With `docker run`, the volume mount can be specified like this.

```sh
docker run -d \
  -p 8200:8200 \
  --name=apm-server \
  --user=apm-server \
  --volume="$(pwd)/apm-server.docker.yml:/usr/share/apm-server/apm-server.yml:ro" \
  docker.elastic.co/apm/apm-server:((version)) \
  --strict.perms=false -e \
  -E output.elasticsearch.hosts=["elasticsearch:9200"] <1> <2>
```

<div id="customize_your_configuration"></div>

### Customize your configuration

export let has_docker_label_ex = false

<DocIf condition={ has_docker_label_ex === true }>
The `apm-server.docker.yml` file you downloaded earlier is configured to deploy ((beats)) modules based on the Docker labels applied to your containers.  See \<\<configuration-autodiscover-hints>> for more details. Add labels to your application Docker containers, and they will be picked up by the ((beats)) autodiscover feature when they are deployed.  Here is an example command for an Apache HTTP Server container with labels to configure the ((filebeat)) and ((metricbeat)) modules for the Apache HTTP Server:

```sh
docker run \
  --label co.elastic.logs/module=apache2 \
  --label co.elastic.logs/fileset.stdout=access \
  --label co.elastic.logs/fileset.stderr=error \
  --label co.elastic.metrics/module=apache \
  --label co.elastic.metrics/metricsets=status \
  --label co.elastic.metrics/hosts='${data.host}:${data.port}' \
  --detach=true \
  --name my-apache-app \
  -p 8080:80 \
  httpd:2.4
```
</DocIf>

<DocIf condition={ has_docker_label_ex === false }>
The `apm-server.docker.yml` downloaded earlier should be customized for your environment. See <DocLink slug="/en/observability/apm-configuring-howto-apm-server">Configure</DocLink> for more details. Edit the configuration file and customize it to match your environment then re-deploy your APM Server container.
</DocIf>

<div id="custom_image_configuration"></div>

### Custom image configuration

It's possible to embed your APM Server configuration in a custom image.
Here is an example Dockerfile to achieve this:

```dockerfile
FROM docker.elastic.co/apm/apm-server:((version))
COPY --chmod=0644 --chown=1000:1000 apm-server.yml /usr/share/apm-server/apm-server.yml
```