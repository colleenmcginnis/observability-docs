---
id: enObservabilityApmCommandLineOptions
slug: /en/observability/apm-command-line-options
title: APM Server command reference
description: Description to be written
tags: []
---

import ApikeySubcommands from './command-reference/apikey-subcommands.mdx'

export let global_flags = `Also see <DocLink id="enObservabilityApmCommandLineOptions" section="global-flags">Global flags</DocLink>.`

export let deploy_command_short_desc = "Deploys the specified function to your serverless environment"

export let apikey_command_short_desc = "Manage API Keys for communication between APM agents and server."

export let serverless = false

<DocIf condition={ serverless === false }>
export let export_command_short_desc = "Exports the configuration, index template, or ((ilm-init)) policy to stdout"

</DocIf>

<DocIf condition={ serverless === true }>
{export_command_short_desc = "Exports the configuration, index template, or {cloudformation_ref} template to stdout"}

</DocIf>

export let help_command_short_desc = "Shows help for any command"

export let keystore_command_short_desc = `Manages the <DocLink id="enObservabilityApmKeystore">secrets keystore</DocLink>`

export let modules_command_short_desc = "Manages configured modules"

export let package_command_short_desc = "Packages the configuration and executable into a zip file"

export let remove_command_short_desc = "Removes the specified function from your serverless environment"

export let run_command_short_desc = "Runs APM Server. This command is used by default if you start APM Server without specifying a command"

export let update_command_short_desc = "Updates the specified function"

export let test_command_short_desc = "Tests the configuration"

export let version_command_short_desc = "Shows information about the current version"

{/* end::attributes[] */}

<div id="apm-command-line-options"></div>

<DocCallOut title="Important" color="warning">
These commands only apply to the APM Server binary installation method.
</DocCallOut>

APM Server provides a command-line interface for starting APM Server and
performing common tasks, like testing configuration files.

The command-line also supports <DocLink id="enObservabilityApmCommandLineOptions" section="global-flags">global flags</DocLink>
for controlling global behaviors.

<DocCallOut title="Tip">

Use `sudo` to run the following commands if:

* the config file is owned by `root`, or
* APM Server is configured to capture data that requires `root` access

</DocCallOut>

Some of the features described here require an Elastic license. For
more information, see https://www.elastic.co/subscriptions and
[License Management](((kibana-ref))/managing-licenses.html).

<DocTable columns={[
  { "title": "Commands" },
  { "title": "" }
]}>
  <DocRow>
    <DocCell>
      <DocLink id="enObservabilityApmCommandLineOptions" section="apikey-command">`apikey`</DocLink>
    </DocCell>
    <DocCell>
      {apikey_command_short_desc}.
    </DocCell>
  </DocRow>
  <DocRow>
    <DocCell>
      <DocLink id="enObservabilityApmCommandLineOptions" section="export-command">`export`</DocLink>
    </DocCell>
    <DocCell>
      {export_command_short_desc}.
    </DocCell>
  </DocRow>
  <DocRow>
    <DocCell>
      <DocLink id="enObservabilityApmCommandLineOptions" section="help-command">`help`</DocLink>
    </DocCell>
    <DocCell>
      {help_command_short_desc}.
    </DocCell>
  </DocRow>
  <DocIf condition={ serverless === false }>
    <DocRow>
      <DocCell>
        <DocLink id="enObservabilityApmCommandLineOptions" section="keystore-command">`keystore`</DocLink>
      </DocCell>
      <DocCell>
        {keystore_command_short_desc}.
      </DocCell>
    </DocRow>
  </DocIf>
  <DocIf condition={ serverless === false }>
    <DocRow>
      <DocCell>
        <DocLink id="enObservabilityApmCommandLineOptions" section="run-command">`run`</DocLink>
      </DocCell>
      <DocCell>
        {run_command_short_desc}.
      </DocCell>
    </DocRow>
  </DocIf>
  <DocRow>
    <DocCell>
      <DocLink id="enObservabilityApmCommandLineOptions" section="test-command">`test`</DocLink>
    </DocCell>
    <DocCell>
      {test_command_short_desc}.
    </DocCell>
  </DocRow>
  <DocRow>
    <DocCell><DocLink id="enObservabilityApmCommandLineOptions" section="version-command">`version`</DocLink></DocCell>
    <DocCell>
      {version_command_short_desc}.
    </DocCell>
  </DocRow>
</DocTable>

Also see <DocLink id="enObservabilityApmCommandLineOptions" section="global-flags">Global flags</DocLink>.

<div id="apm-apikey-command"></div>

## `apikey` command

<DocCallOut template="technical_preview" />
<DocCallOut title="Deprecated in 8.6.0" color="danger">
Users should create API Keys through ((kib)) or the ((es)) REST API. See <DocLink id="enObservabilityApmApiKey">API keys</DocLink>.
</DocCallOut>

Communication between APM agents and APM Server now supports sending an
<DocLink id="enObservabilityApmApiKey">API Key in the Authorization header</DocLink>.
APM Server provides an `apikey` command that can create, verify, invalidate,
and show information about API Keys for agent/server communication.
Most operations require the `manage_own_api_key` cluster privilege,
and you must ensure that `apm-server.api_key` or `output.elasticsearch` are configured appropriately.

**SYNOPSIS**

```sh
apm-server apikey SUBCOMMAND [FLAGS]
```

**`SUBCOMMAND`**

<ApikeySubcommands />

**FLAGS**

<DocDefList>
  <DocDefTerm>**`--agent-config`**</DocDefTerm>
  <DocDefDescription>
    Required for agents to read configuration remotely. Valid with the `create` and `verify` subcommands.
    When used with `create`, gives the `config_agent:read` privilege to the created key.
    When used with `verify`, asks for the `config_agent:read` privilege.
  </DocDefDescription>

  <DocDefTerm>**`--credentials CREDS`**</DocDefTerm>
  <DocDefDescription>
    Required for the `verify` subcommand. Specifies the credentials for which to check privileges.
    Credentials are the base64 encoded representation of the API key's `id:api_key`.
  </DocDefDescription>

  <DocDefTerm>**`--expiration TIME`**</DocDefTerm>
  <DocDefDescription>
    When used with `create`, specifies the expiration for the key, e.g., "1d" (default never).
  </DocDefDescription>

  <DocDefTerm>**`--id ID`**</DocDefTerm>
  <DocDefDescription>
    ID of the API key. Valid with the `info` and `invalidate` subcommands.
    When used with `info`, queries the specified ID.
    When used with `invalidate`, deletes the specified ID.
  </DocDefDescription>

  <DocDefTerm>**`--ingest`**</DocDefTerm>
  <DocDefDescription>
    Required for ingesting events. Valid with the `create` and `verify` subcommands.
    When used with `create`, gives the `event:write` privilege to the created key.
    When used with `verify`, asks for the `event:write` privilege.
  </DocDefDescription>

  <DocDefTerm>**`--json`**</DocDefTerm>
  <DocDefDescription>
    Prints the output of the command as JSON.
    Valid with all `apikey` subcommands.
  </DocDefDescription>

  <DocDefTerm>**`--name NAME`**</DocDefTerm>
  <DocDefDescription>
    Name of the API key(s). Valid with the `create`, `info`, and `invalidate` subcommands.
    When used with `create`, specifies the name of the API key to be created (default: "apm-key").
    When used with `info`, specifies the API key to query (multiple matches are possible).
    When used with `invalidate`, specifies the API key to delete (multiple matches are possible).
  </DocDefDescription>

  <DocDefTerm>**`--sourcemap`**</DocDefTerm>
  <DocDefDescription>
    Required for uploading source maps. Valid with the `create` and `verify` subcommands.
    When used with `create`, gives the `sourcemap:write` privilege to the created key.
    When used with `verify`, asks for the `sourcemap:write` privilege.
  </DocDefDescription>

  <DocDefTerm>**`--valid-only`**</DocDefTerm>
  <DocDefDescription>
    When used with `info`, only returns valid API Keys (not expired or invalidated).
  </DocDefDescription>
</DocDefList>

{global_flags}

**EXAMPLES**

```sh
apm-server apikey create --ingest --agent-config --name example-001
apm-server apikey info --name example-001 --valid-only
apm-server apikey invalidate --name example-001
```

For more information, see <DocLink id="enObservabilityApmApiKey">API keys</DocLink>.

<div id="apm-export-command"></div>

## `export` command

<DocIf condition={ serverless === false }>
((empty)){export_command_short_desc}. You can use this
command to quickly view your configuration or see the contents of the index
template or the ((ilm-init)) policy.
</DocIf>

<DocIf condition={ serverless === true }>
((empty)){export_command_short_desc}. You can use this
command to quickly view your configuration, see the contents of the index
template and the ((ilm-init)) policy, or export an CloudFormation template.
</DocIf>

**SYNOPSIS**

```sh
apm-server export SUBCOMMAND [FLAGS]
```

**`SUBCOMMAND`**

<DocDefList>
  <DocDefTerm>**`config`**</DocDefTerm>
  <DocDefDescription>
    Exports the current configuration to stdout. If you use the `-c` flag, this
    command exports the configuration that's defined in the specified file.
  </DocDefDescription>

  <DocDefTerm>
    <span id="apm-template-subcommand">
      **`template`**
    </span>
  </DocDefTerm>
  <DocDefDescription>
    Exports the index template to stdout. You can specify the `--es.version` and
    `--index` flags to further define what gets exported. Furthermore you can export
    the template to a file instead of `stdout` by defining a directory via `--dir`.
  </DocDefDescription>

  <DocDefTerm>
    <span id="apm-ilm-policy-subcommand">
      **`ilm-policy`**
    </span>
  </DocDefTerm>
  <DocDefDescription>
    Exports the ((ilm)) policy to stdout. You can specify the
    `--es.version` and a `--dir` to which the policy should be exported as a
    file rather than exporting to `stdout`.
  </DocDefDescription>

  <DocIf condition={ serverless === true }>
    <DocDefTerm>
      <span id="apm-function-subcommand">
        **`function` FUNCTION_NAME**
      </span>
    </DocDefTerm>
    <DocDefDescription>
      Exports an \{cloudformation_ref} template to stdout.
    </DocDefDescription>
  </DocIf>
</DocDefList>

**FLAGS**

<DocDefList>
  <DocDefTerm>
    **`--es.version VERSION`**
  </DocDefTerm>
  <DocDefDescription>
    When used with <DocLink id="enObservabilityApmCommandLineOptions" section="apm-template-subcommand">`template`</DocLink>, exports an index
    template that is compatible with the specified version.
    When used with <DocLink id="enObservabilityApmCommandLineOptions" section="apm-ilm-policy-subcommand">`ilm-policy`</DocLink>, exports the ((ilm-init)) policy
    if the specified ES version is enabled for ((ilm-init)).
  </DocDefDescription>

  <DocDefTerm>
    **`-h, --help`**
  </DocDefTerm>
  <DocDefDescription>
    Shows help for the `export` command.

  <DocDefTerm>
    **`--index BASE_NAME`**
  </DocDefTerm>
    : When used with <DocLink id="enObservabilityApmCommandLineOptions" section="apm-template-subcommand">`template`</DocLink>, sets the base name to use for
    the index template. If this flag is not specified, the default base name is
    `apm-server`.
  </DocDefDescription>

  <DocDefTerm>
    **`--dir DIRNAME`**
  </DocDefTerm>
  <DocDefDescription>
    Define a directory to which the template and ((ilm-init)) policy should be exported to
    as files instead of printing them to `stdout`.
  </DocDefDescription>
</DocDefList>

((empty)){global_flags}

**EXAMPLES**

<DocIf condition={ serverless === false }>

```sh
apm-server export config
apm-server export template --es.version ((version)) --index myindexname
```
</DocIf>

<DocIf condition={ serverless === true }>

```sh
apm-server export config
apm-server export template --es.version ((version)) --index myindexname
apm-server export function cloudwatch
```
</DocIf>

<div id="apm-help-command"></div>

## `help` command

((empty)){help_command_short_desc}.

<DocIf condition={ serverless === false }>
If no command is specified, shows help for the `run` command.
</DocIf>

**SYNOPSIS**

```sh
apm-server help COMMAND_NAME [FLAGS]
```

<DocDefList>
  <DocDefTerm>
    **`COMMAND_NAME`**
  </DocDefTerm>
  <DocDefDescription>
    Specifies the name of the command to show help for.
  </DocDefDescription>
</DocDefList>

**FLAGS**

<DocDefList>
  <DocDefTerm>
    **`-h, --help`**
  </DocDefTerm>
  <DocDefDescription>
    Shows help for the `help` command.
  </DocDefDescription>
</DocDefList>

((empty)){global_flags}

**EXAMPLE**

```sh
apm-server help export
```

<DocIf condition={ serverless === false }>

<div id="apm-keystore-command"></div>

## `keystore` command

((empty)){keystore_command_short_desc}.

**SYNOPSIS**

```sh
apm-server keystore SUBCOMMAND [FLAGS]
```

**`SUBCOMMAND`**

<DocDefList>
  <DocDefTerm>
    **`add KEY`**
  </DocDefTerm>
  <DocDefDescription>
    Adds the specified key to the keystore. Use the `--force` flag to overwrite an
    existing key. Use the `--stdin` flag to pass the value through `stdin`.
  </DocDefDescription>

  <DocDefTerm>
    **`create`**
  </DocDefTerm>
  <DocDefDescription>
    Creates a keystore to hold secrets. Use the `--force` flag to overwrite the
    existing keystore.
  </DocDefDescription>

  <DocDefTerm>
    **`list`**
  </DocDefTerm>
  <DocDefDescription>
    Lists the keys in the keystore.
  </DocDefDescription>

  <DocDefTerm>
    **`remove KEY`**
  </DocDefTerm>
  <DocDefDescription>
    Removes the specified key from the keystore.
  </DocDefDescription>
</DocDefList>

**FLAGS**

<DocDefList>
  <DocDefTerm>
    **`--force`**
  </DocDefTerm>
  <DocDefDescription>
    Valid with the `add` and `create` subcommands. When used with `add`, overwrites
    the specified key. When used with `create`, overwrites the keystore.
  </DocDefDescription>

  <DocDefTerm>
    **`--stdin`**
  </DocDefTerm>
  <DocDefDescription>
    When used with `add`, uses the stdin as the source of the key's value.
  </DocDefDescription>

  <DocDefTerm>
    **`-h, --help`**
  </DocDefTerm>
  <DocDefDescription>
    Shows help for the `keystore` command.
  </DocDefDescription>
</DocDefList>

((empty)){global_flags}

**EXAMPLES**

```sh
apm-server keystore create
apm-server keystore add ES_PWD
apm-server keystore remove ES_PWD
apm-server keystore list
```

See <DocLink id="enObservabilityApmKeystore">Secrets keystore for secure settings</DocLink> for more examples.

</DocIf>

<DocIf condition={ serverless === false }>

<div id="apm-run-command"></div>

## `run` command

((empty)){run_command_short_desc}.

**SYNOPSIS**

```sh
apm-server run [FLAGS]
```

Or:

```sh
apm-server [FLAGS]
```

**FLAGS**

<DocDefList>
  <DocDefTerm>
    **`-N, --N`**
  </DocDefTerm>
  <DocDefDescription>
    Disables publishing for testing purposes.
  </DocDefDescription>

  <DocDefTerm>
    **`--cpuprofile FILE`**
  </DocDefTerm>
  <DocDefDescription>
    Writes CPU profile data to the specified file. This option is useful for
    troubleshooting APM Server.
  </DocDefDescription>

  <DocDefTerm>
    **`-h, --help`**
  </DocDefTerm>
  <DocDefDescription>
    Shows help for the `run` command.
  </DocDefDescription>

  <DocDefTerm>
    **`--httpprof [HOST]:PORT`**
  </DocDefTerm>
  <DocDefDescription>
    Starts an HTTP server for profiling. This option is useful for troubleshooting
    and profiling APM Server.
  </DocDefDescription>

  <DocDefTerm>
    **`--memprofile FILE`**
  </DocDefTerm>
  <DocDefDescription>
    Writes memory profile data to the specified output file. This option is useful
    for troubleshooting APM Server.
  </DocDefDescription>

  <DocDefTerm>
    **`--system.hostfs MOUNT_POINT`**
  </DocDefTerm>
  <DocDefDescription>
    Specifies the mount point of the host's file system for use in monitoring a host.
  </DocDefDescription>
</DocDefList>

((empty)){global_flags}

**EXAMPLE**

```sh
apm-server run -e
```

Or:

```sh
apm-server -e
```
</DocIf>

<div id="apm-test-command"></div>

## `test` command

((empty)){test_command_short_desc}.

**SYNOPSIS**

```sh
apm-server test SUBCOMMAND [FLAGS]
```

**`SUBCOMMAND`**

<DocDefList>
  <DocDefTerm>
    **`config`**
  </DocDefTerm>
  <DocDefDescription>
    Tests the configuration settings.
  </DocDefDescription>

  <DocDefTerm>
    **`output`**
  </DocDefTerm>
  <DocDefDescription>
    Tests that APM Server can connect to the output by using the
    current settings.
  </DocDefDescription>
</DocDefList>

**FLAGS**

**`-h, --help`**
    : Shows help for the `test` command.

((empty)){global_flags}

**EXAMPLE**

```sh
apm-server test config
```

<div id="apm-version-command"></div>

## `version` command

((empty)){version_command_short_desc}.

**SYNOPSIS**

```sh
apm-server version [FLAGS]
```

**FLAGS**

<DocDefList>
  <DocDefTerm>
    **`-h, --help`**
  </DocDefTerm>
  <DocDefDescription>
    Shows help for the `version` command.
  </DocDefDescription>
</DocDefList>

((empty)){global_flags}

**EXAMPLE**

```sh
apm-server version
```

<div id="apm-global-flags"></div>

# Global flags

These global flags are available whenever you run APM Server.

<DocDefList>

  <DocDefTerm>
    **`-E, --E "SETTING_NAME=VALUE"`**
  </DocDefTerm>
  <DocDefDescription>
    Overrides a specific configuration setting. You can specify multiple overrides.
    For example:

    ```sh
    apm-server -E "name=mybeat" -E "output.elasticsearch.hosts=['http://myhost:9200']"
    ```

    This setting is applied to the currently running APM Server process.
    The APM Server configuration file is not changed.
  </DocDefDescription>

  <DocDefTerm>**`-c, --c FILE`**</DocDefTerm>
  <DocDefDescription>
    Specifies the configuration file to use for APM Server. The file you specify
    here is relative to `path.config`. If the `-c` flag is not specified, the
    default config file, `apm-server.yml`, is used.
  </DocDefDescription>

  <DocDefTerm>**`-d, --d SELECTORS`**</DocDefTerm>
  <DocDefDescription>
    Enables debugging for the specified selectors. For the selectors, you can
    specify a comma-separated
    list of components, or you can use `-d "*"` to enable debugging for all
    components. For example, `-d "publisher"` displays all the publisher-related
    messages.
  </DocDefDescription>

  <DocDefTerm>**`-e, --e`**</DocDefTerm>
  <DocDefDescription>
    Logs to stderr and disables syslog/file output.
  </DocDefDescription>

  <DocDefTerm>**`-environment`**</DocDefTerm>
  <DocDefDescription>
    For logging purposes, specifies the environment that APM Server is running in.
    This setting is used to select a default log output when no log output is configured.
    Supported values are: `systemd`, `container`, `macos_service`, and `windows_service`.
    If `systemd` or `container` is specified, APM Server will log to stdout and stderr
    by default.
  </DocDefDescription>

  <DocDefTerm>**`--path.config`**</DocDefTerm>
  <DocDefDescription>
    Sets the path for configuration files. See the <DocLink id="enObservabilityApmDirectoryLayout">Installation layout</DocLink> section for
    details.
  </DocDefDescription>

  <DocDefTerm>**`--path.data`**</DocDefTerm>
  <DocDefDescription>
    Sets the path for data files. See the <DocLink id="enObservabilityApmDirectoryLayout">Installation layout</DocLink> section for details.
  </DocDefDescription>

  <DocDefTerm>**`--path.home`**</DocDefTerm>
  <DocDefDescription>
    Sets the path for miscellaneous files. See the <DocLink id="enObservabilityApmDirectoryLayout">Installation layout</DocLink> section for
    details.
  </DocDefDescription>

  <DocDefTerm>**`--path.logs`**</DocDefTerm>
  <DocDefDescription>
    Sets the path for log files. See the <DocLink id="enObservabilityApmDirectoryLayout">Installation layout</DocLink> section for details.
  </DocDefDescription>

  <DocDefTerm>**`--strict.perms`**</DocDefTerm>
  <DocDefDescription>
    Sets strict permission checking on configuration files. The default is `-strict.perms=true`.
    See \<\<apm-config-file-ownership>> for more information.
  </DocDefDescription>

  <DocDefTerm>**`-v, --v`**</DocDefTerm>
  <DocDefDescription>
    Logs INFO-level messages.
  </DocDefDescription>
</DocDefList>

{global_flags = undefined}

{deploy_command_short_desc = undefined}

{apikey_command_short_desc = undefined}

{export_command_short_desc = undefined}

{export_command_short_desc = undefined}

{export_command_short_desc = undefined}

{help_command_short_desc = undefined}

{keystore_command_short_desc = undefined}

{modules_command_short_desc = undefined}

{package_command_short_desc = undefined}

{remove_command_short_desc = undefined}

{run_command_short_desc = undefined}

{update_command_short_desc = undefined}

{test_command_short_desc = undefined}

{version_command_short_desc = undefined}
