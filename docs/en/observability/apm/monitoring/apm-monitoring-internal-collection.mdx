---
id: enObservabilityApmMonitoringInternalCollection
slug: /en/observability/apm-monitoring-internal-collection
title: Use internal collection to send monitoring data
description: Description to be written
tags: []
---

import ApmConfigurationMonitor from './apm-configuration-monitor.mdx'

<div id="apm-monitoring-internal-collection"></div>

Use internal collectors to send ((beats)) monitoring data directly to your
monitoring cluster.

export let serverless = false
export let no_output_logstash = false

<DocIf condition={ serverless === false }>
Or as an alternative to internal collection, use <DocLink id="enObservabilityApmMonitoringMetricbeatCollection">Use ((metricbeat)) to send monitoring data</DocLink>. The benefit of using internal collection
instead of ((metricbeat)) is that you have fewer pieces of software to install
and maintain.
</DocIf>

{/* Commenting out this link temporarily until the general monitoring docs can be */}
{/* updated. */}
{/* To learn about monitoring in general, see */}
{/* ((ref))/monitor-elasticsearch-cluster.html[Monitor a cluster]. */}

1. Create an API key or user that has appropriate authority to send system-level monitoring
    data to ((es)). For example, you can use the built-in `apm_system` user or
    assign the built-in `apm_system` role to another user. For more
    information on the required privileges, see <DocLink id="enObservabilityApmPrivilegesToPublishMonitoring">Grant privileges and roles needed for monitoring</DocLink>.
    For more information on how to use API keys, see <DocLink id="enObservabilityApmBeatsApiKeys">Grant access using API keys</DocLink>.

2. Add the `monitoring` settings in the APM Server configuration file. If you
    configured the ((es)) output and want to send APM Server monitoring events to
    the same ((es)) cluster, specify the following minimal configuration:

    ```yml
    monitoring:
    enabled: true
    elasticsearch:
    api_key:  id:api_key  [^1]
    username: apm_system
    password: somepassword
    ```
    [^1]: Specify one of `api_key` or `username`/`password`.

    If you want to send monitoring events to an [((ecloud))](https://cloud.elastic.co/)
    monitoring cluster, you can use two simpler settings. When defined, these settings
    overwrite settings from other parts in the configuration. For example:

    ```yaml
    monitoring:
    enabled: true
    cloud.id: 'staging:dXMtZWFzdC0xLmF3cy5mb3VuZC5pbyRjZWM2ZjI2MWE3NGJmMjRjZTMzYmI4ODExYjg0Mjk0ZiRjNmMyY2E2ZDA0MjI0OWFmMGNjN2Q3YTllOTYyNTc0Mw=='
    cloud.auth: 'elastic:((pwd))'
    ```

    If you <DocIf condition={ no_output_logstash === false }>configured a different output, such as ((ls)) or you</DocIf>want to send APM Server monitoring events to a separate ((es)) cluster
    (referred to as the _monitoring cluster_), you must specify additional
    configuration options. For example:

    ```yml
    monitoring:
      enabled: true
      cluster_uuid: PRODUCTION_ES_CLUSTER_UUID  [^1]
      elasticsearch:
        hosts: ["https://example.com:9200", "https://example2.com:9200"]  [^2]
        api_key:  id:api_key  [^3]
        username: apm_system
        password: somepassword
    ```
    [^1]: This setting identifies the ((es)) cluster under which the
    monitoring data for this APM Server instance will appear in the
    ((stack-monitor-app)) UI. To get a cluster's `cluster_uuid`,
    call the `GET /` API against that cluster.
    [^2]: This setting identifies the hosts and port numbers of ((es)) nodes
    that are part of the monitoring cluster.
    [^3]: Specify one of `api_key` or `username`/`password`.

    If you want to use PKI authentication to send monitoring events to
    ((es)), you must specify a different set of configuration options. For
    example:

    ```yaml
    monitoring:
      enabled: true
      cluster_uuid: PRODUCTION_ES_CLUSTER_UUID
      elasticsearch:
        hosts: ["https://example.com:9200", "https://example2.com:9200"]
        username: ""
        ssl.certificate_authorities: ["/etc/pki/root/ca.pem"]
        ssl.certificate: "/etc/pki/client/cert.pem"
        ssl.key: "/etc/pki/client/cert.key"
    ```

    You must specify the `username` as `""` explicitly so that
    the username from the client certificate (`CN`) is used. See
    <DocLink id="enObservabilityApmConfigurationSsl">SSL/TLS output settings</DocLink> for more information about SSL settings.

<DocIf condition={ serverless === false }>
3. Start APM Server.
</DocIf>

<DocIf condition={ serverless === true }>
3. Deploy APM Server.
</DocIf>

4. [View the monitoring data in ((kib))](((kibana-ref))/monitoring-data.html).

<ApmConfigurationMonitor />
