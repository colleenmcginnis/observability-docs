---
slug: /en/observability/apm-configure-agent-config
title: Configure APM agent configuration
description: Description to be written
tags: []
---

import ApmSupportOverview from '../components/support-overview.mdx'

<div id="apm-configure-agent-config"></div>

<ApmSupportOverview binary={true} fleet={true}>
  APM agent configuration is supported by all APM Server deployment methods.
</ApmSupportOverview>

APM agent configuration allows you to fine-tune your APM agents from within the APM app.
Changes are automatically propagated to your APM agents, so there's no need to redeploy your applications.

To learn more about this feature, see [APM agent configuration](((kibana-ref))/agent-configuration.html).

Here's a sample configuration:

```yaml
apm-server.agent.config.cache.expiration: 45s
apm-server.agent.config.elasticsearch.api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA
```

<div id="apm_agent_configuration_options"></div>

## APM agent configuration options

The following options are only supported for APM Server binary users.
You can specify these options in the `apm-server.agent.config` section of the
`apm-server.yml` config file:

<div id="apm-agent-config-cache"></div>

### `apm-server.agent.config.cache.expiration`

When using APM agent configuration, information fetched from ((es)) will be cached in memory for some time.
Specify the cache expiration time via this setting. Defaults to `30s` (30 seconds).

<div id="apm-agent-config-elasticsearch"></div>

### `apm-server.agent.config.elasticsearch`

Takes the same options as <DocLink slug="/en/observability/apm-elasticsearch-output">output.elasticsearch</DocLink>.

For APM Server binary users and Elastic Agent standalone-managed APM Server,
APM agent configuration is automatically fetched from ((es)) using the `output.elasticsearch`
configuration. If `output.elasticsearch` isn't set or doesn't have sufficient privileges,
use these ((es)) options to provide ((es)) access.

<div id="common_problems"></div>

### Common problems

You may see either of the following HTTP 403 errors from APM Server when it attempts to fetch APM agent configuration:

APM agent log:

```log
"Your Elasticsearch configuration does not support agent config queries. Check your configurations at `output.elasticsearch` or `apm-server.agent.config.elasticsearch`."
```

APM Server log:

```log
rejecting fetch request: no valid elasticsearch config
```

This occurs because the user or API key set in either `apm-server.agent.config.elasticsearch` or `output.elasticsearch`
(if `apm-server.agent.config.elasticsearch` is not set) does not have adequate permissions to read source maps from ((es)).

To fix this error, ensure that APM Server has all the required privileges. See <DocLink slug="/en/observability/apm-privileges-agent-central-config" section="apm-server-agent-central-configuration-management">APM Server agent central configuration management</DocLink> for more details.
