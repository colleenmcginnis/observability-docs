---
slug: /en/observability/apm-configuration-instrumentation
title: Configure APM instrumentation
description: Description to be written
tags: []
---

import ApmSupportOverview from '../components/support-overview.mdx'

<div id="apm-configuration-instrumentation"></div>

<ApmSupportOverview binary={true} fleet={false}>
  Instrumentation of APM Server is not yet supported for Fleet-managed APM.
</ApmSupportOverview>

APM Server uses the Elastic APM Go Agent to instrument its publishing pipeline.
To gain insight into the performance of APM Server, you can enable this instrumentation and send trace data to APM Server.
Currently, only the ((es)) output is instrumented.

Example configuration with instrumentation enabled:

```yaml
instrumentation:
  enabled: true
  environment: production
  hosts:
    - "http://localhost:8200"
  api_key: L5ER6FEvjkmlfalBealQ3f3fLqf03fazfOV
```

<div id="configuration_options"></div>

## Configuration options

You can specify the following options in the `instrumentation` section of the `apm-server.yml` config file:

<div id="`enabled`"></div>

### `enabled`

Set to `true` to enable instrumentation of APM Server.
Defaults to `false`.

<div id="`environment`"></div>

### `environment`

Set the environment in which APM Server is running, for example, `staging`, `production`, `dev`, etc.
Environments can be filtered in the [((apm-app))](((kibana-ref))/xpack-apm.html).

<div id="`hosts`"></div>

### `hosts`

The [APM Server](((observability-guide))/apm-getting-started-apm-server.html) hosts to report instrumentation data to.
Defaults to `http://localhost:8200`.

<div id="`api_key`"></div>

### `api_key`

[API key](((observability-guide))/apm-api-key.html) used to secure communication with the APM Server(s).
If `api_key` is set then `secret_token` will be ignored.

<div id="`secret_token`"></div>

### `secret_token`

[Secret token](((observability-guide))/apm-secret-token.html) used to secure communication with the APM Server(s).
