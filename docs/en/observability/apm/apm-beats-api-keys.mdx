---
slug: /en/observability/apm-beats-api-keys
title: Grant access using API keys
description: Description to be written
tags: []
---


<div id="apm-beats-api-keys"></div>

Instead of using usernames and passwords, you can use API keys to grant
access to ((es)) resources. You can set API keys to expire at a certain time,
and you can explicitly invalidate them. Any user with the `manage_api_key`
or `manage_own_api_key` cluster privilege can create API keys.

APM Server instances typically send both collected data and monitoring
information to ((es)). If you are sending both to the same cluster, you can use the same
API key. For different clusters, you need to use an API key per cluster.

<DocCallOut title="Note">
For security reasons, we recommend using a unique API key per APM Server instance.
You can create as many API keys per user as necessary.
</DocCallOut>

<div id="apm-beats-api-key-publish"></div>

## Create an API key for writing events

In ((kib)), navigate to **((stack-manage-app))** > **API keys** and click **Create API key**.

![API key creation](images/server-api-key-create.png)

Enter a name for your API key and select **Restrict privileges**.
In the role descriptors box, assign the appropriate privileges to the new API key. For example:

```json
{
    "apm_writer": {
        "index": [
            {
                "names": ["apm-*"],
                "privileges": ["create_index", "create_doc"]
            }
        ]
    },
    "apm_sourcemap": {
        "index": [
            {
                "names": [".apm-source-map"],
                "privileges": ["read"]
            }
        ]
    },
    "apm_agentcfg": {
        "index": [
            {
                "names": [".apm-agent-configuration"],
                "privileges": ["read"]
            }
        ]
    }
}
```

<DocCallOut title="Note">
This example only provides privileges for **writing data**.
See <DocLink slug="/en/observability/apm-secure-comms-stack" section="feature-roles">Feature roles</DocLink> for additional privileges and information.
</DocCallOut>

To set an expiration date for the API key, select **Expire after time**
and input the lifetime of the API key in days.

Click **Create API key**. In the dropdown, switch to **((beats))** and copy the API key.

You can now use this API key in your `apm-server.yml` configuration file:

```yml
output.elasticsearch:
  api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA  [^1]
```
[^1]: Format is `id:api_key` (as shown in the ((beats)) dropdown)

<div id="apm-beats-api-key-monitor"></div>

## Create an API key for monitoring

In ((kib)), navigate to **((stack-manage-app))** > **API keys** and click **Create API key**.

![API key creation](images/server-api-key-create.png)

Enter a name for your API key and select **Restrict privileges**.
In the role descriptors box, assign the appropriate privileges to the new API key.
For example:

```json
{
    "apm_monitoring": {
        "index": [
            {
                "names": [".monitoring-beats-*"],
                "privileges": ["create_index", "create_doc"]
            }
      ]
    }
}
```

<DocCallOut title="Note">
This example only provides privileges for **publishing monitoring data**.
See <DocLink slug="/en/observability/apm-secure-comms-stack" section="feature-roles">Feature roles</DocLink> for additional privileges and information.
</DocCallOut>

To set an expiration date for the API key, select **Expire after time**
and input the lifetime of the API key in days.

Click **Create API key**. In the dropdown, switch to **((beats))** and copy the API key.

You can now use this API key in your `apm-server.yml` configuration file like this:

```yml
monitoring.elasticsearch:
  api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA  [^1]
```
[^1]: Format is `id:api_key` (as shown in the ((beats)) dropdown)

<div id="apm-beats-api-key-es"></div>

## Create an API key with ((es)) APIs

You can also use ((es))'s [Create API key API](((ref))/security-api-create-api-key.html) to create a new API key.
For example:

```console
POST /_security/api_key
{
  "name": "apm_host001",  [^1]
  "role_descriptors": {
    "apm_writer": {  [^2]
      "index": [
        {
          "names": ["apm-*"],
          "privileges": ["create_index", "create_doc"]
        }
      ]
    },
    "apm_sourcemap": {
      "index": [
        {
          "names": [".apm-source-map"],
          "privileges": ["read"]
        }
      ]
    },
    "apm_agentcfg": {
      "index": [
        {
          "names": [".apm-agent-configuration"],
          "privileges": ["read"]
        }
      ]
    }
  }
}
```
[^1]: Name of the API key
[^2]: Granted privileges, see <DocLink slug="/en/observability/apm-secure-comms-stack" section="feature-roles">Feature roles</DocLink>

See the [Create API key](((ref))/security-api-create-api-key.html) reference for more information.

<div id="apm-learn-more-api-keys"></div>

## Learn more about API keys

See the ((es)) API key documentation for more information:

* [Create API key](((ref))/security-api-create-api-key.html)
* [Get API key information](((ref))/security-api-get-api-key.html)
* [Invalidate API key](((ref))/security-api-invalidate-api-key.html)

