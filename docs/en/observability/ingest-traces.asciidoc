[[traces-apm-get-started]]
= Get started with application traces and APM

++++
<titleabbrev>Traces and APM</titleabbrev>
++++

//TODO: Ask Brandon--can I rename this file? I guess we will need to coordinate
//with a corresponding update for APM. I just think it's good to rip of the
//bandaid and give these files accurate names. WDYT?

// THIS CONTENT IS ALSO USED IN THE APM GUIDE
// tag::apm-quick-start[]

This guide describes how to:

* Collect Application Performance Monitoring (APM) data
* Send APM data to the {stack}
* Explore and visualize the data in real-time

For feedback and questions, please contact us in the {forum}[discuss forum].

[discrete]
[[ingest-prereqs-traces]]
== Prerequisites

//TODO: Ask Brandon if it's Ok to make this a shared region. I'm thinking "no"
//because it will get weird, but maybe if we use the full path in the include,
//it will be OK?

To follow the steps in this guide, you need an {stack} deployment that includes:

* {es} for storing and searching data
* {kib} for visualizing and managing data
* Kibana user with `All` privileges on {fleet} and Integrations. Since many
Integrations assets are shared across spaces, users need the Kibana privileges
in all spaces.
* Integrations Server (included by default in every {ess} deployment)

To get started quickly, spin up a deployment of our hosted {ess}]. The {ess} is
available on AWS, GCP, and Azure. {ess-trial}[Try it out for free].

TIP: Not using {fleet}? Advanced users who want to configure and manage
{agent}s manually can
{fleet-guide}/install-standalone-elastic-agent.html[run agents standalone].

[discrete]
[[add-apm-integration]]
== Step 1: Configure the APM integration

{ecloud} runs a hosted version of {integrations-server} that includes the APM integration.
Self-managed users will need to add the APM integration before configuring it.

include::./tab-widgets/add-apm-integration/widget.asciidoc[]

[discrete]
[[add-agent-to-fleet-traces]]
== Step 2: Install and run an {agent} on your machine

//TODO: Ask Brandon how to handle references to self managed users here

****
This step is optional for both {ess} and self-managed users as
{ecloud} spins up an {agent} instance automatically, and self managed users installed an {agent} instance manually in Step 1.
Unless you need to add additional {agent}s, skip this step.
****

{agent} is a single, unified way to add monitoring for logs, metrics, and other
types of data to a host. It can also protect hosts from security threats, query
data from operating systems, forward data from remote services or hardware, and
more. A single agent makes it easier and faster to deploy monitoring across your
infrastructure. Each agent has a single policy you can update to add
integrations for new data sources, security protections, and more.

Don't confuse {agent} with APM agents--they are different components.
In a later step, you'll instrument your code with APM agents and send the data
to an APM Server instance that {agent} spins up.

If you plan on enabling Real User Monitoring (RUM), you must run {agent} centrally.
If RUM is disabled, you should run {agent} on edge machines.

To send APM data to the {stack}:

include::{ingest-docs-root}/docs/en/ingest-management/elastic-agent/install-fleet-managed-elastic-agent.asciidoc[tag=agent-enroll]


[discrete]
[[add-apm-integration-agents]]
== Step 3: Install APM agents

APM agents are written in the same language as your service.
To monitor a new service, you must install the agent and configure it with a service name,
APM Server host, and Secret token.

* **Service name**: The APM integration maps an instrumented service's name–defined in each {apm-agent}'s configuration–
to the index that its data is stored in {es}.
Service names are case-insensitive and must be unique.
For example, you cannot have a service named `Foo` and another named `foo`.
Special characters will be removed from service names and replaced with underscores (`_`).

* **APM Server URL**: The host and port that APM Server listens for events on.
This should match the host and port defined when setting up the APM integration.

* **Secret token**: Authentication method for {apm-agent} and APM Server communication.
This should match the secret token defined when setting up the APM integration.

TIP: You can edit your APM integration settings if you need to change the APM Server URL
or secret token to match your APM agents.

--
// this if directive includes the same file, but changes the file path based on where this guide is built
ifndef::apm-integration-docs[]
include::{apm-repo-dir}/legacy/tab-widgets/install-agents-widget.asciidoc[]
endif::[]

ifdef::apm-integration-docs[]
include::{docdir}/legacy/tab-widgets/install-agents-widget.asciidoc[]
endif::[]
--

[discrete]
[[view-apm-integration-data]]
== Step 4: View your data

Back in {kib}, under {observability}, select APM.
You should see application performance monitoring data flowing into the {stack}!

NOTE: The built-in `apm_user` role is not compatible with the APM integration
as it only provides read access to `apm-*` indices.
For a list of indices users need access to, refer to
{apm-guide-ref}/apm-data-streams.html[APM data streams]

[role="screenshot"]
image::images/kibana-apm-sample-data.png[{apm-app} with data]

Not seeing any data? Review our list of {apm-guide-ref}/common-problems.html[common problems] for helpful tips.

[discrete]
== What's next?

* Now that data is streaming into the {stack}, take your investigation to a
deeper level! Use https://www.elastic.co/observability[Elastic {observability}]
to unify your logs, metrics, uptime, and application performance data.

* Want to protect your endpoints from security threats? Try
https://www.elastic.co/security[{elastic-sec}]. Adding endpoint protection is
just another integration that you add to the agent policy!

* Are your eyes bleary from staring at a wall of screens?
{observability-guide}/create-alerts.html[Create alerts] and find out about
problems while sipping your favorite beverage poolside.

* Want Elastic to do the heavy lifting? Use {ml} to
{observability-guide}/inspect-log-anomalies.html[detect anomalies].

* Got everything working like you want it? Roll out your agent policies to
other hosts by deploying {agent}s across your infrastructure!

// end::apm-quick-start[]
